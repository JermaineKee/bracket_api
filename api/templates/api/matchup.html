<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>matchup</title>


      <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
      <link rel="stylesheet" href="{% static 'main.css' %}"/>

  </head>
  <body>

<div id="win_center">
    <h3> {{ a }}
    vs.
    {{ b }} </h3>
  </div>
<div>
<button onclick="a_b_win({{a_id}})">{{ a }} wins!</button>
<button onclick="a_b_win({{b_id}})">{{ b }} wins!</button>
</div>
     <br>
<div>
{% if a_email %}
<a href="{% url 'send_email' a_id %}"><button>Email {{ a }}</i></button></a>
{% else %}
<form action="" method="put">
    {% csrf_token %}
<input type="button" id="add_email()" onClick="addEmail({{ a_id }})" value="Add Email" />
<div id="email_input"></div>
</form>


{% endif %}
{% if b_email %}
<a href="{% url 'send_email' b_id %}"><button>Email {{ b }}</button></a>
{% else %}
<form action="" method="put">
    {% csrf_token %}
<input type="button" id="add_email()" onClick="addEmail({{ b_id }})" value="Add Email" />
<div id="email_input"></div>
</form>


{% endif %}
</div>
  </body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
<script>

function a_b_win(winner) {
                $.ajax({
                  url: "/" + "update_bracket/" + {{ bracket_id }} + "/" + winner,
                  type: "PUT",
                  headers: {
                      "Authorization": "Basic " + btoa("admin:password")
                  }
                }).then(
                  window.location = "/matchup/" + {{ bracket_id }} + "/" + {{ parent_id }}
                );
            };


function addEmail(competitor) {
                var div = document.createElement('div');
                div.innerHTML = '<input type="text" class="comp_email" name="email" size="12" autocomplete="off" placeholder="Email"/><div class="divider"></div><input onClick="add_contact('+competitor+')" type="submit"/>';
                document.getElementById('email_input').appendChild(div);
            }

function add_contact(competitor){
  var email = $(".comp_email").val();
  console.log("email : " + email)
  $("form").submit(
    $.ajax(
          {
            async: false,
            url: "/add_contact_email/" + competitor,
            type: "PUT",
            headers: {
                    "Authorization": "Basic " + btoa("admin:password")
                     },
            data: {
                  "email": email
                  }
            })).success(
                    // setTimeout(donothing,1000);
                    window.location = "/matchup/" + {{ bracket_id }} + "/" + {{ parent_id }}
                    );
                };



function add_contact_email(competitor) {
          var email = $(".comp_email").val();
          console.log(competitor)
          $("form").submit(
                  $.ajax(
                        {
                          url: "/add_contact/" + competitor,
                          type: "PUT",
                          headers: {
                                  "Authorization": "Basic " + btoa("admin:password")
                                   },
                          data: {
                                "email": email
                                }
                          })).then(
                                  window.location = "/matchup/" + {{ bracket_id }} + "/" + {{ parent_id }}
                                  );
                              };

</script>

</html>
